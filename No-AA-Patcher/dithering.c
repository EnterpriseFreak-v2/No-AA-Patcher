#include <stdio.h>
#include <string.h>
#include <stdint.h>

/* Credits for this pattern: NoobletCheese @ GBATemp
* Source: https://gbatemp.net/threads/possible-to-disable-the-wiis-de-flicker-filter.477163/page-8#post-9481457 */
const char ptr[] = {0x3C, 0x80, 0xCC, 0x01, 0x38, 0xA0, 0x00, 0x61, 0x38, 0x00, 0x00, 0x00, 0x80, 0xC7, 0x02, 0x20,
					0x50, 0x66, 0x17, 0x7A, 0x98, 0xA4, 0x80, 0x00, 0x90, 0xC4, 0x80, 0x00, 0x90, 0xC7, 0x02, 0x20,
					0xB0, 0x07, 0x00, 0x02, 0x4E, 0x80, 0x00, 0x20}; 

const char ptr_no_dither[] = { 0x48, 0x00, 0x00, 0x28 };

void applyDitheringPatch(char* buffer, size_t bufsize)
{
	char* position = 0;

	for (int i = 0; i < bufsize - sizeof(ptr); i++)
	{
		position = (char*)buffer + i;

		if (memcmp(position, ptr, 40) == 0)
		{
			memcpy(position - 4, ptr_no_dither, 4);
		}
	}
}
